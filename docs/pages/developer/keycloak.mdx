# Keycloak Management

To use a realm, import it manually into your Keycloak instance from `config/nuh-{environment}.json`

We use three clients in Keycloak, one for the backend, frontend, and worker respectively. The backend and frontend clients will authenticate a user against the Keycloak instance, whilst the worker runs as a service application.

## Roles, Permissions, Groups, and Claims

A role in Keycloak is really a [permission](https://www.keycloak.org/docs/latest/server_admin/index.html#assigning-permissions-using-roles-and-groups).

A group is a combination of roles, that can be applied to many users.

So a user is part of a group to grant them permission to resources.

We define claims in the backend, and use `RequireRealmRoles` to build policies based on them. The `SitePermissionClaims` should use the same string as the name of your Keycloak role.

Additionally, these claims are defined on the frontend in `auth/Permissions`, which are similarly built into policies, which can be accessed on the session at a request level. They are used in Next.js `middleware.ts` to authorise at a route level.

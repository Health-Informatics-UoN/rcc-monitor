parameters:
  - name: nodeVersion
    type: string
    default: 18.12.x 
  - name: packageName
    type: string
  - name: buildScript
    type: string
    default: build

steps:
  - bash: |
      if [ -z "$PACKAGE_NAME" ]; then
        echo "##vso[task.logissue type=error;]Missing template parameter \"packageName\""
        echo "##vso[task.complete result=Failed;]"
      fi
    env:
      PACKAGE_NAME: ${{ parameters.packageName }}
    displayName: Check for required parameters

  - task: NodeTool@0
    inputs:
      versionSpec: ${{ parameters.nodeVersion }}
    displayName: Setup Node.js

  - script: |
      npm ci --prefix app/${{ parameters.packageName }}
    displayName: npm ci

  - script: npm run build
    workingDirectory: app/${{ parameters.packageName }}
    displayName: npm run build

  - task: PublishPipelineArtifact@1
    inputs:
      targetPath: "app/${{ parameters.packageName }}"
      artifact: "drop"
